# Pre-race Scenario UI

シナリオを入力してベース予測を補正し、結果を確認・保存するUIです。

## 起動方法

```bash
# プロジェクトルートから
python ui/pre_race/server.py

# ブラウザで http://localhost:8080 にアクセス
```

## 使い方

1. **レース選択**: `artifacts/pre_race/` 以下のレースJSONを選択して読み込み
2. **シナリオ入力**: ペース/馬場/バイアス/逃げ想定馬を入力
3. **シナリオを適用**: クリックして補正を実行
4. **結果確認**: ベース順位→補正順位のΔと補正理由を確認
5. **結果を保存**: `artifacts/ui_runs/` にJSON出力

## シナリオ入力項目

| 項目 | 値 | 説明 |
|------|-----|------|
| ペース予想 | S/M/H | スロー/ミドル/ハイ |
| 馬場状態 | 良/稍重/重/不良 | 当日の馬場 |
| バイアス | 内/フラット/外 | トラックバイアス |
| 逃げ想定馬 | 馬番リスト | カンマ区切り（例: 1, 5） |
| メモ | 自由記述 | シナリオの根拠など |

## 補正ロジック

### ペース補正

| ペース | 逃げ | 先行 | 差し | 追込 |
|--------|------|------|------|------|
| S（スロー） | +20% | +10% | -5% | -15% |
| M（ミドル） | ±0% | ±0% | ±0% | ±0% |
| H（ハイ） | -20% | -10% | +10% | +20% |

### バイアス補正

| バイアス | 内枠 | 中枠 | 外枠 |
|----------|------|------|------|
| 内伸び | +5% | ±0% | -3% |
| フラット | ±0% | ±0% | ±0% |
| 外伸び | -3% | ±0% | +5% |

## 出力例

`artifacts/ui_runs/20241229_150000_202412290605.json`:

```json
{
  "race_id": "202412290605",
  "race_name": "有馬記念",
  "scenario": {
    "pace": "S",
    "track_condition": "良",
    "bias": "内",
    "front_runner_ids": ["2020104567"],
    "notes": "スローペース想定、内伸び"
  },
  "entries": [
    {
      "umaban": 1,
      "name": "テストホース1",
      "base_rank_win": 2,
      "adj_rank_win": 1,
      "delta_rank_win": 1,
      "reasons": ["ペースSで逃げ有利", "内伸びバイアス有利", "逃げ想定馬"]
    }
  ],
  "adjusted_at": "2024-12-29T15:00:00"
}
```

## ディレクトリ構成

```
ui/pre_race/
├── server.py      # HTTPサーバー & APIエンドポイント
├── index.html     # シナリオUI (HTML/JS)
└── README.md      # このファイル
```

## 依存関係

- Python 3.11+
- 追加パッケージ不要（標準ライブラリのみ）

## 注意事項

- このUIは開発用のローカルサーバーです
- 本番環境での使用は想定していません
- 補正ロジックは仮実装です（精度は保証しません）
