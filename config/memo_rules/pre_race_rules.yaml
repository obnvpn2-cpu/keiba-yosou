# Pre-race memo parsing rules
# メモから提案チップを生成するためのルールベース辞書
#
# 構造:
# - keywords: キーワード → 適用提案のマッピング
# - intensity_modifiers: 強度修飾語（超/かなり/やや等）
# - negation_patterns: 否定パターン（〜ではない等）
# - conflict_rules: 相反検出ルール

version: "2.0"

# =============================================================================
# 馬場状態 (track_condition)
# =============================================================================
track_condition:
  良:
    keywords:
      - "高速馬場"
      - "超高速"
      - "時計が速い"
      - "時計速い"
      - "速い時計"
      - "パンパン"
      - "カラカラ"
      - "乾いた馬場"
      - "開幕週"
      - "開幕"
      - "Aコース"
      - "軽い馬場"
      - "軽い芝"
    label: "馬場：良（高速示唆）"
    reason: "高速馬場のキーワードを検出"

  稍重:
    keywords:
      - "稍重"
      - "やや重い"
      - "少し渋い"
      - "時計がかかる"
      - "時計かかる"
      - "やや時計がかかる"
    label: "馬場：稍重"
    reason: "稍重示唆のキーワードを検出"

  重:
    keywords:
      - "重馬場"
      - "道悪"
      - "渋い馬場"
      - "渋った"
      - "力のいる馬場"
      - "タフな馬場"
      - "パワーが必要"
    label: "馬場：重"
    reason: "重馬場示唆のキーワードを検出"

  不良:
    keywords:
      - "不良"
      - "ぐちゃぐちゃ"
      - "極悪"
      - "泥んこ"
      - "かなりの道悪"
      - "最悪の馬場"
    label: "馬場：不良"
    reason: "不良馬場示唆のキーワードを検出"

# =============================================================================
# 進路バイアス (lane_bias) - どのラインが伸びるか
# 枠に直結させず、推定される通り道への作用
# =============================================================================
lane_bias:
  inner:
    keywords:
      - "内伸び"
      - "内が伸びる"
      - "内ラチ沿い"
      - "内を通す"
      - "内有利"
      - "インコース有利"
      - "内を通した馬"
      - "開幕週"
      - "開幕"
      - "Aコース"
      - "仮柵移動なし"
      - "内を立ち回れる"
      - "経済コース"
      - "ロスなく"
    label: "進路：内寄り"
    reason: "内ラチ沿いが伸びる傾向を検出"

  middle:
    keywords:
      - "中央"
      - "真ん中"
      - "馬場の中央"
      - "中ほど"
    label: "進路：中央"
    reason: "馬場中央が良い傾向を検出"

  outer:
    keywords:
      - "外伸び"
      - "外が伸びる"
      - "外差し"
      - "大外"
      - "外を回す"
      - "外有利"
      - "アウトコース有利"
      - "開催後半"
      - "内が荒れ"
      - "内が掘れ"
      - "内が悪い"
      - "馬場が傷んで"
      - "Bコース"
      - "Cコース"
      - "仮柵移動後"
    label: "進路：外寄り"
    reason: "外めのラインが伸びる傾向を検出"

# =============================================================================
# 脚質バイアス (style_bias) - 前が残る/差しが届く
# =============================================================================
style_bias:
  front:
    keywords:
      - "前残り"
      - "前が残る"
      - "先行有利"
      - "前有利"
      - "逃げ有利"
      - "逃げ・先行有利"
      - "前目につけた馬"
      - "先行馬有利"
      - "先行力"
      - "好位"
      - "スローで前"
      - "ペースが緩い"
      - "上がり勝負"
      - "ヨーイドン"
      - "直線短い"
      - "スロー"
      - "超スロー"
      - "前傾ラップ"
      - "前半スロー"
    label: "脚質：前寄り（先行有利）"
    reason: "前残り傾向を検出"

  closer:
    keywords:
      - "差し有利"
      - "差しが届く"
      - "追込有利"
      - "差し・追込有利"
      - "ハイペース"
      - "差し馬有利"
      - "後方から"
      - "末脚"
      - "流れが速い"
      - "ペースが流れ"
      - "消耗戦"
      - "スタミナ勝負"
      - "直線長い"
      - "直線が長い"
      - "外から差し"
    label: "脚質：差し寄り（差し・追込有利）"
    reason: "差し・追込有利傾向を検出"

# =============================================================================
# ペース予想 (pace)
# =============================================================================
pace:
  S:  # スロー
    keywords:
      - "スロー"
      - "超スロー"
      - "ペースが緩い"
      - "緩いペース"
      - "スローペース"
      - "前が楽"
      - "逃げ馬不在"
      - "ペース落ち着く"
      - "瞬発力勝負"
      - "上がり勝負"
      - "ヨーイドン"
      - "直線勝負"
      - "4F勝負"
      - "33秒台"
    label: "展開：スロー"
    reason: "スローペース示唆を検出"

  M:  # ミドル
    keywords:
      - "ミドル"
      - "平均ペース"
      - "淡々"
      - "ペースは落ち着くが"
    label: "展開：ミドル"
    reason: "ミドルペース示唆を検出"

  H:  # ハイ
    keywords:
      - "ハイペース"
      - "ハイ"
      - "速いペース"
      - "ペースが流れる"
      - "ペース流れる"
      - "逃げ争い"
      - "先行争い"
      - "テンが速い"
      - "テン3F"
      - "前が激しい"
      - "消耗戦"
      - "スタミナ勝負"
      - "後半バテる"
      - "35秒台"
      - "36秒"
    label: "展開：ハイペース"
    reason: "ハイペース示唆を検出"

# =============================================================================
# 強度修飾語 (intensity_modifiers)
# キーワードの直前にあるとスコアを変化させる
# =============================================================================
intensity_modifiers:
  very_strong:  # スコア +0.3
    words:
      - "超"
      - "極めて"
      - "相当"
      - "圧倒的に"
      - "極端に"
      - "かなりの"
    multiplier: 1.5

  strong:  # スコア +0.2
    words:
      - "かなり"
      - "非常に"
      - "とても"
      - "かなりの"
      - "明らかに"
      - "明確に"
    multiplier: 1.3

  moderate:  # デフォルト
    words: []
    multiplier: 1.0

  weak:  # スコア -0.2
    words:
      - "やや"
      - "少し"
      - "ちょっと"
      - "多少"
      - "若干"
      - "微妙に"
    multiplier: 0.7

  very_weak:  # スコア -0.3
    words:
      - "ほぼ"
      - "ほとんど"
      - "気持ち"
    multiplier: 0.5

# =============================================================================
# 否定パターン (negation_patterns)
# これらがキーワードの周辺にあると、意味が反転する
# =============================================================================
negation_patterns:
  - "ではない"
  - "じゃない"
  - "ない"
  - "なさそう"
  - "にくい"
  - "しにくい"
  - "ほど〜ではない"
  - "とは言えない"
  - "とは思えない"
  - "にならない"
  - "ことはない"
  - "わけではない"
  - "というほどでも"
  - "微妙"

# =============================================================================
# 相反ルール (conflict_rules)
# 同時に検出されると矛盾として警告
# =============================================================================
conflict_rules:
  - pair: ["lane_bias.inner", "lane_bias.outer"]
    message: "進路バイアスが矛盾しています（内伸び vs 外伸び）"

  - pair: ["style_bias.front", "style_bias.closer"]
    message: "脚質バイアスが矛盾しています（前残り vs 差し有利）"

  - pair: ["pace.S", "pace.H"]
    message: "ペース予想が矛盾しています（スロー vs ハイ）"

  - pair: ["track_condition.良", "track_condition.重"]
    message: "馬場状態が矛盾しています（良 vs 重）"

  - pair: ["track_condition.良", "track_condition.不良"]
    message: "馬場状態が矛盾しています（良 vs 不良）"

# =============================================================================
# 血統キーワード (pedigree) - 現状は特徴量なし
# needs_feature として注意表示するのみ
# =============================================================================
pedigree:
  needs_feature: true
  advisory_message: "血統情報は現在の特徴量に含まれていません。将来的な特徴量化候補として記録しています。"
  keywords:
    deep_impact:
      - "ディープインパクト"
      - "ディープ産駒"
      - "ディープ系"
      - "SS系"
      - "サンデー系"
    stamina:
      - "スタミナ血統"
      - "長距離血統"
      - "ステイヤー血統"
    speed:
      - "スピード血統"
      - "短距離血統"
      - "スプリンター血統"
    dirt:
      - "ダート血統"
      - "パワー血統"
    heavy_track:
      - "道悪血統"
      - "重馬場血統"
      - "パワー型"
      - "母父ノーザンダンサー"
    turf:
      - "芝血統"
      - "芝向き"

# =============================================================================
# アドバイザリータグ (advisory_tags)
# メモから検出可能な馬の特徴タグ（補正には使わない）
# =============================================================================
advisory_tags:
  positive:
    - pattern: "スタート上手"
      tag: "スタート○"
    - pattern: "ゲート上手"
      tag: "ゲート○"
    - pattern: "二の脚"
      tag: "二の脚○"
    - pattern: "スピード持続"
      tag: "持続力○"
    - pattern: "末脚確実"
      tag: "末脚○"
    - pattern: "切れる脚"
      tag: "瞬発力○"
    - pattern: "勝負根性"
      tag: "根性○"
    - pattern: "相手なり"
      tag: "相手なり"
    - pattern: "安定感"
      tag: "安定○"
    - pattern: "道悪得意"
      tag: "道悪○"
    - pattern: "道悪○"
      tag: "道悪○"
    - pattern: "渋った馬場"
      tag: "道悪○"
    - pattern: "高速馬場得意"
      tag: "高速○"
    - pattern: "高速○"
      tag: "高速○"
    - pattern: "休み明け得意"
      tag: "休み明け○"
    - pattern: "叩いて良化"
      tag: "叩き良化"
    - pattern: "上積み"
      tag: "上積み"
    - pattern: "調子良"
      tag: "好調"
    - pattern: "仕上がり良"
      tag: "仕上○"
    - pattern: "追い切り好時計"
      tag: "調教○"

  negative:
    - pattern: "スタート難"
      tag: "出遅れ注意"
    - pattern: "ゲート難"
      tag: "出遅れ注意"
    - pattern: "出遅れ"
      tag: "出遅れ注意"
    - pattern: "スタート不安"
      tag: "出遅れ注意"
    - pattern: "折り合い難"
      tag: "折り合い注意"
    - pattern: "掛かり癖"
      tag: "折り合い注意"
    - pattern: "気性難"
      tag: "気性注意"
    - pattern: "道悪苦手"
      tag: "道悪×"
    - pattern: "道悪×"
      tag: "道悪×"
    - pattern: "高速苦手"
      tag: "高速×"
    - pattern: "距離不安"
      tag: "距離?"
    - pattern: "初距離"
      tag: "初距離"
    - pattern: "久々"
      tag: "休み明け"
    - pattern: "休み明け"
      tag: "休み明け"
    - pattern: "太め"
      tag: "馬体注意"
    - pattern: "細め"
      tag: "馬体注意"
    - pattern: "減り"
      tag: "馬体注意"
    - pattern: "調整遅れ"
      tag: "仕上×"

# =============================================================================
# 騎手関連キーワード
# =============================================================================
jockey:
  advisory_tags:
    - pattern: "騎手得意"
      tag: "騎手○"
    - pattern: "相性良い"
      tag: "人馬相性○"
    - pattern: "乗り替わり"
      tag: "乗り替わり"
    - pattern: "テン乗り"
      tag: "初騎乗"
    - pattern: "リーディング"
      tag: "騎手上位"
    - pattern: "勝負駆け"
      tag: "騎手○"
    - pattern: "消極的"
      tag: "騎乗注意"
    - pattern: "ミス"
      tag: "騎乗注意"
